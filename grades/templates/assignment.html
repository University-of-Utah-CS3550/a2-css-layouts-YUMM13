<div class="Container">
  <!-- page header -->
  {% include "header.html" with title="Assignment" %}

  <!-- main page -->
  <main>
    <div>
      <span class="pageTitle">{{assignment.title}}</span>
      <div class="horizonalLine"></div>
      Due {{assignment.deadline}}, total of {{assignment.points}} point{{ assignment.points|pluralize }}
    </div>

    {% if isStudent %}
    <!-- Student submissions box -->
    <aside>
      <p>{{ status }}</p>
      {% if ontime %}
      <form method="post" action="/{{id}}/" enctype="multipart/form-data"/>
        {% csrf_token %}
        {% if errors %}
        <output>
          {% for e, msg in errors.items %}
            {{ msg }}
          {% endfor %}
        </output>
        {% endif %}
        <label for="submission">Submit:</label>
        <input
          type="file" 
          name="submission"
          />
        <button>Submit</button>
      </form>
      {% endif %}
    </aside>
    {% else %}

    <script>
      function make_form_async(form) {
        form.addEventListener("submit", async (event) => {
          console.log("Running");
          // remove default action
          event.preventDefault();
  
          // construct form data instance
          const formData = new FormData(form);
  
          // grab the csrf token
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  
          // try to send the form data
          try {
              const response = await fetch(form.action, {
                  headers: {
                    'X-CSRFToken': csrfToken,
                  }
                  method: "POST",
                  body: formData,
              });
              if (response.ok) {
                  console.log("Upload Succeeded!");
                  let success = document.createElement("p");
                  success.innerText = "Upload Succeeded!11";
                  form.appendChild(success);
              }
              else {
                console.log("Upload Failed")
                let failed = document.createElement("p");
                failed.innerText = "Upload Failed!11";
                form.appendChild(failed);
              }
          } catch (e) {
              console.log("An error ocurred while submitting your work: ", e);
          }
        });
      }
      const form = document.querySelector('form');
      make_form_async(form);
    </script>

    <!-- TA submissions box -->
    <aside>
      <p>Currently {{totalSubmissions}}/{{totalStudents}} submission{{ totalStudents|pluralize }}</p>  
      <p>{% if not isAdmin %}{{totalAssigned}} submission{{ totalAssigned|pluralize }} assigned to you {% endif %}<a href="/{{assignment.id}}/submissions">Grade</a></p>
    </aside>
    {% endif %}
    <!-- description -->
    <h4>Description</h4>
    {{assignment.description|safe}}
    
    <img
    src="/static/assignments.png"
    alt="an image of the assignments page. The page includes a list of all assignments, their due dates, and thier weights. "
    />
  </main>
</div>